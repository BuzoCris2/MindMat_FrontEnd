<div class="programming-game-container">
  <!-- Introducción -->
  <div *ngIf="currentTextIndex === 0" class="story-panel">
    <img class="intro-image" src="assets/img/Characters/monkeyCharacter.png" alt="Rover el Mono" />
    <h1>¡Ayuda a Rover a encontrar su camino!</h1>
    <p>
      Guía a Rover usando bloques de comandos para completar el tablero. ¡Evita los obstáculos y alcanza la meta!
    </p>
    <button class="start-button" (click)="updateTextIndex(1)">Comenzar</button>
  </div>

  <!-- Tablero de juego -->
  <div *ngIf="currentTextIndex === 1" class="game-panel">
    <div class="game-container">
      <!-- Tablero -->
      <div class="grid">
        <div
          *ngFor="let cell of grid; let i = index"
          class="cell"
          [class.rover]="i === roverPosition"
          [class.flag]="i === flagPosition"
          [class.obstacle]="obstacles.includes(i)"
        >
          <!-- Animación de explosión si hay colisión -->
          <div *ngIf="i === explosionPosition && isHitAnimating" class="explosion-animation">
            <img src="assets/img/mathleship/hitAnim.gif" alt="Explosión" />
          </div>
  
          <img *ngIf="i === roverPosition && !isHitAnimating" src="assets/img/Characters/monkeyCharacter.png" alt="Rover" />
          <img *ngIf="i === flagPosition" src="assets/img/Characters/turtleCharacter2.png" alt="Meta" />
          <img *ngIf="obstacles.includes(i) && !(i === explosionPosition && isHitAnimating)" src="assets/img/Characters/crocodileCharacter.png" alt="Obstáculo" />
        </div>
      </div>

      <!-- Bloques de comandos -->
      <div class="command-section">
        <img class="character-image" src="assets/img/Characters/monkeyCharacter.png" alt="Mono Decorativo" />
        <div class="commands-section">
          <h3>Elige tus comandos:</h3>
          <div class="block" draggable="true" (dragstart)="drag($event, 'move')">Avanzar</div>
          <div class="block" draggable="true" (dragstart)="drag($event, 'left')">Girar Izquierda</div>
          <div class="block" draggable="true" (dragstart)="drag($event, 'right')">Girar Derecha</div>
        </div>
        <div class="dropzone" (dragover)="allowDrop($event)" (drop)="drop($event)">
          <p *ngIf="commands.length === 0">Arrastra los comandos aquí</p>
          <div *ngFor="let command of commands" class="command">{{ command }}</div>
        </div>
        <button class="start-button" (click)="executeCommands()">Ejecutar Comandos</button>
      </div>
    </div>
  </div>

  <!-- Barra de vidas -->
  <div class="lives-container" *ngIf="currentTextIndex === 1">
    <img *ngFor="let life of lives" class="life" src="assets/img/heart.png" alt="Vida" />
  </div>

  <!-- Fin del nivel -->
  <div *ngIf="currentTextIndex === 2" class="end-screen">
    <h1>¡Felicidades, nivel completado! 🎉</h1>
    <p>¡Rover llegó a su destino con éxito!</p>
    <img src="assets/img/Characters/turtleCharacter2.png" alt="Meta" class="meta-animation" />
    <button (click)="resetGame()">Reiniciar</button>
  </div>
</div>
